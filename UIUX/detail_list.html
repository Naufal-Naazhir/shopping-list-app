<!-- detail_list.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List Detail</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="theme-styles.css">
    <script src="theme-handler.js"></script>
    <script src="user-data-helper.js"></script>
    <script src="premium-system.js"></script>
</head>
<body>
    <div class="container">
        <div class="header" style="display: flex; align-items: center; justify-content: space-between;">
            <a href="index.html" style="text-decoration: none; font-size: 1.5rem; color: #333;">&larr;</a>
            <h1 id="list-title" style="flex: 1; text-align: center; margin: 0;">My List</h1>
            <span id="menu-btn" style="font-size: 1.5rem; color: #333; cursor: pointer;">‚ãÆ</span>
        </div>
        <div class="content" id="items-container" style="padding: 20px; min-height: 400px;">
            <!-- Items will be loaded here -->
        </div>
    </div>
    
    <!-- Custom Delete Notification -->
    <div id="delete-notification" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; backdrop-filter: blur(4px);">
        <div id="notification-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.8); background: #fff; border-radius: 20px; padding: 24px; width: 85%; max-width: 320px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); opacity: 0; transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);">
            <div style="text-align: center; margin-bottom: 20px;">
                <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; font-size: 2rem; box-shadow: 0 4px 12px rgba(255,107,107,0.3);">üóëÔ∏è</div>
                <h3 style="margin: 0 0 8px 0; font-size: 1.3rem; color: #333;">Delete Item?</h3>
                <p id="delete-item-name" style="margin: 0; color: #666; font-size: 0.95rem;">Are you sure you want to delete this item?</p>
            </div>
            <div style="display: flex; gap: 12px;">
                <button id="cancel-delete" style="flex: 1; padding: 14px; border: 2px solid #ddd; background: #fff; color: #666; border-radius: 12px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.2s;">Cancel</button>
                <button id="confirm-delete" style="flex: 1; padding: 14px; border: none; background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%); color: #fff; border-radius: 12px; font-size: 1rem; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(255,107,107,0.3); transition: all 0.2s;">Delete</button>
            </div>
        </div>
    </div>
    <script>
        // Check if user is logged in
        if (localStorage.getItem('isLoggedIn') !== 'true') {
            window.location.href = 'login.html';
        }
        
        // Load list name and items from localStorage
        document.addEventListener('DOMContentLoaded', function() {
            const listName = localStorage.getItem('currentListName') || 'My List';
            document.getElementById('list-title').textContent = listName;
            
            loadItems();
        });

        function getTextColor() {
            return document.body.classList.contains('dark-mode') ? '#e0e0e0' : '#333';
        }

        function loadItems() {
            const items = JSON.parse(localStorage.getItem('listItems') || '[]');
            const container = document.getElementById('items-container');
            
            if (items.length === 0) {
                // Empty state
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px;">
                        <div style="font-size: 3rem; margin-bottom: 20px; color: #ddd;">üìù</div>
                        <h3 style="font-size: 1.2rem; color: ${getTextColor()}; margin-bottom: 12px; font-weight: 600;">No items yet</h3>
                        <p style="font-size: 0.95rem; color: #888; margin-bottom: 32px;">Start adding items to your list</p>
                        <a href="tambah_item.html" style="display: inline-block; background: #22b14c; color: #fff; border-radius: 28px; font-size: 1.1rem; padding: 16px 40px; text-decoration: none; font-weight: bold; box-shadow: 0 4px 12px rgba(34,177,76,0.2); transition: all 0.2s;">+ ADD ITEM</a>
                    </div>
                `;
            } else {
                // Display items
                container.innerHTML = '';
                items.forEach((item, index) => {
                    const itemDiv = document.createElement('div');
                    itemDiv.style.cssText = 'display: flex; align-items: center; padding: 14px 0; border-bottom: 1px solid #eee;';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.checked = item.checked || false;
                    checkbox.style.cssText = 'width: 22px; height: 22px; margin-right: 14px; cursor: pointer; accent-color: #22b14c;';
                    checkbox.addEventListener('change', function() {
                        items[index].checked = this.checked;
                        localStorage.setItem('listItems', JSON.stringify(items));
                        updateAllLists(items);
                        loadItems(); // Reload to update styling
                    });
                    
                    const labelContainer = document.createElement('div');
                    labelContainer.style.cssText = 'flex: 1; display: flex; flex-direction: column;';
                    
                    const label = document.createElement('span');
                    label.textContent = item.name;
                    label.style.cssText = 'font-size: 1.05rem; color: ' + (item.checked ? '#999' : getTextColor()) + '; text-decoration: ' + (item.checked ? 'line-through' : 'none') + ';';
                    
                    const priceSpan = document.createElement('span');
                    const itemPrice = item.price || getItemPrice(item.name);
                    priceSpan.textContent = itemPrice;
                    priceSpan.style.cssText = 'font-size: 0.9rem; color: ' + (item.checked ? '#bbb' : '#22b14c') + '; font-weight: 600; margin-top: 2px;';
                    
                    labelContainer.appendChild(label);
                    labelContainer.appendChild(priceSpan);
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.textContent = 'üóëÔ∏è';
                    deleteBtn.style.cssText = 'background: none; border: none; font-size: 1.2rem; cursor: pointer; padding: 4px 8px;';
                    deleteBtn.addEventListener('click', function() {
                        showDeleteNotification(item.name, index);
                    });
                    
                    itemDiv.appendChild(checkbox);
                    itemDiv.appendChild(labelContainer);
                    itemDiv.appendChild(deleteBtn);
                    container.appendChild(itemDiv);
                });
                
                // Calculate totals
                const total = items.length;
                const checked = items.filter(i => i.checked).length;
                let totalPrice = 0;
                let checkedPrice = 0;
                let uncheckedPrice = 0;
                
                items.forEach(item => {
                    const price = parsePrice(item.price || getItemPrice(item.name));
                    totalPrice += price;
                    if (item.checked) {
                        checkedPrice += price;
                    } else {
                        uncheckedPrice += price;
                    }
                });
                
                // Add summary
                const summary = document.createElement('div');
                summary.style.cssText = 'margin-top: 20px; padding: 16px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 12px; border: 1px solid #dee2e6;';
                
                let summaryHTML = `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: #666;">Items Completed:</span>
                        <strong style="color: ${getTextColor()};">${checked}/${total}</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="color: #666;">Unchecked Total:</span>
                        <strong style="color: #ff9800;">${formatPrice(uncheckedPrice)}</strong>
                    </div>
                `;
                
                // Only show Checked Total and Grand Total if there are checked items
                if (checked > 0) {
                    summaryHTML += `
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #666;">Checked Total:</span>
                            <strong style="color: #22b14c;">${formatPrice(checkedPrice)}</strong>
                        </div>
                        <div style="border-top: 2px solid #dee2e6; margin: 12px 0; padding-top: 12px; display: flex; justify-content: space-between;">
                            <span style="font-size: 1.1rem; font-weight: bold; color: ${getTextColor()};">Grand Total:</span>
                            <strong style="font-size: 1.2rem; color: #22b14c;">${formatPrice(totalPrice)}</strong>
                        </div>
                    `;
                }
                
                summary.innerHTML = summaryHTML;
                container.appendChild(summary);
                
                // Check if user can add more items
                const listIndex = parseInt(localStorage.getItem('currentListIndex'));
                const canAdd = canAddItem(listIndex);
                
                if (canAdd.allowed) {
                    // Add button at bottom
                    const addBtn = document.createElement('a');
                    addBtn.href = 'tambah_item.html';
                    addBtn.style.cssText = 'display: block; margin: 24px auto 0; background: #22b14c; color: #fff; border-radius: 28px; font-size: 1.1rem; padding: 16px 40px; text-decoration: none; font-weight: bold; box-shadow: 0 4px 12px rgba(34,177,76,0.2); text-align: center; max-width: 200px;';
                    addBtn.textContent = '+ ADD ITEM';
                    container.appendChild(addBtn);
                } else {
                    // Show upgrade prompt
                    const upgradePrompt = document.createElement('div');
                    upgradePrompt.style.cssText = 'margin: 24px 20px; padding: 20px; background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%); border-radius: 16px; text-align: center; box-shadow: 0 4px 12px rgba(255,165,0,0.3);';
                    upgradePrompt.innerHTML = `
                        <div style="font-size: 2rem; margin-bottom: 12px;">üíé</div>
                        <div style="font-size: 1.2rem; font-weight: bold; color: #000; margin-bottom: 8px;">Free Limit Reached</div>
                        <div style="font-size: 0.9rem; color: #333; margin-bottom: 16px;">You've reached the maximum of 5 items for free accounts</div>
                        <button onclick="showUpgradeModal()" style="background: #000; color: #FFD700; border: none; padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1rem;">
                            ‚ö° Upgrade to Premium
                        </button>
                    `;
                    container.appendChild(upgradePrompt);
                }
            }
        }

        function getItemPrice(itemName) {
            // Database harga item (harga dalam Rupiah)
            const priceDatabase = {
                'beras 5kg': 65000, 'beras': 13000, 'minyak goreng 2l': 32000, 'minyak goreng': 16000, 'minyak': 16000,
                'gula pasir 1kg': 15000, 'gula pasir': 15000, 'gula': 15000, 'telur 1kg': 28000, 'telur': 28000,
                'susu uht': 12000, 'susu': 12000, 'roti tawar': 14000, 'roti': 10000, 'sabun mandi': 8000, 'sabun': 5000,
                'deterjen': 18000, 'shampo': 15000, 'pasta gigi': 12000, 'tisu': 8000, 'sayur bayam': 5000, 'bayam': 5000,
                'wortel': 8000, 'kentang': 12000, 'bawang merah': 35000, 'bawang putih': 40000, 'cabai': 25000, 'cabe': 25000,
                'tomat': 10000, 'daging ayam': 35000, 'ayam': 35000, 'ikan': 40000, 'ikan segar': 45000, 'tempe': 8000, 'tahu': 6000,
                'sayur kangkung': 4000, 'kangkung': 4000, 'cabai rawit': 30000, 'jahe': 15000, 'kunyit': 12000, 'lengkuas': 10000,
                'daun salam': 5000, 'serai': 3000, 'selai': 18000, 'mentega': 22000, 'sereal': 35000, 'keju': 45000, 'yogurt': 15000,
                'oatmeal': 28000, 'madu': 40000, 'nasi': 5000, 'sambal': 8000, 'lauk pauk': 20000, 'lauk': 20000, 'sop': 15000,
                'sup': 15000, 'kerupuk': 5000, 'sayur': 8000, 'buah': 15000, 'salad': 20000, 'protein': 35000, 'karbohidrat': 10000,
                'minuman': 8000, 'dessert': 25000, 'keripik': 10000, 'coklat': 15000, 'biskuit': 12000, 'permen': 5000, 'kacang': 15000,
                'wafer': 8000, 'cookies': 20000, 'popcorn': 12000, 'es krim': 18000, 'jelly': 8000, 'air mineral': 5000, 'teh': 8000,
                'kopi': 12000, 'jus': 15000, 'soda': 8000, 'sirup': 18000, 'minuman energi': 10000, 'yogurt drink': 12000,
                'smoothie': 25000, 'kue': 50000, 'snack': 15000, 'piring kertas': 10000, 'gelas plastik': 8000, 'balon': 15000,
                'dekorasi': 30000, 'es batu': 5000, 'serbet': 8000, 'lilin': 10000, 'kue ulang tahun': 150000, 'hadiah': 100000,
                'topi pesta': 15000, 'confetti': 12000, 'nasi kotak': 25000, 'tikar': 50000, 'kantong sampah': 8000, 'sunblock': 45000,
                'payung': 75000, 'cooler box': 150000, 'cemilan': 15000, 'sayur fresh': 10000, 'daging': 50000, 'bumbu dapur': 20000,
                'pizza': 85000
            };
            
            const itemLower = itemName.toLowerCase();
            if (priceDatabase[itemLower]) return formatPrice(priceDatabase[itemLower]);
            for (let key in priceDatabase) {
                if (itemLower.includes(key) || key.includes(itemLower)) return formatPrice(priceDatabase[key]);
            }
            return 'Rp 10.000';
        }
        
        function formatPrice(price) {
            if (typeof price === 'string') return price;
            return 'Rp ' + price.toLocaleString('id-ID');
        }
        
        function parsePrice(priceString) {
            if (typeof priceString === 'number') return priceString;
            return parseInt(priceString.replace(/[^0-9]/g, '')) || 0;
        }

        let deleteItemIndex = null;
        
        function showDeleteNotification(itemName, index) {
            deleteItemIndex = index;
            const notification = document.getElementById('delete-notification');
            const content = document.getElementById('notification-content');
            const itemNameEl = document.getElementById('delete-item-name');
            
            itemNameEl.innerHTML = `Are you sure you want to delete <strong style="color: ${getTextColor()};">${itemName}</strong>?`;
            
            notification.style.display = 'block';
            setTimeout(() => {
                content.style.opacity = '1';
                content.style.transform = 'translate(-50%, -50%) scale(1)';
            }, 10);
        }
        
        function hideDeleteNotification() {
            const notification = document.getElementById('delete-notification');
            const content = document.getElementById('notification-content');
            
            content.style.opacity = '0';
            content.style.transform = 'translate(-50%, -50%) scale(0.8)';
            
            setTimeout(() => {
                notification.style.display = 'none';
                deleteItemIndex = null;
            }, 300);
        }
        
        document.getElementById('cancel-delete').addEventListener('click', function() {
            hideDeleteNotification();
        });
        
        document.getElementById('confirm-delete').addEventListener('click', function() {
            if (deleteItemIndex !== null) {
                const items = JSON.parse(localStorage.getItem('listItems') || '[]');
                items.splice(deleteItemIndex, 1);
                localStorage.setItem('listItems', JSON.stringify(items));
                updateAllLists(items);
                hideDeleteNotification();
                loadItems();
            }
        });
        
        // Close notification when clicking outside
        document.getElementById('delete-notification').addEventListener('click', function(e) {
            if (e.target === this) {
                hideDeleteNotification();
            }
        });

        function updateAllLists(items) {
            const listIndex = parseInt(localStorage.getItem('currentListIndex'));
            const allLists = getUserLists();
            
            if (allLists[listIndex] !== undefined) {
                allLists[listIndex].items = items;
                allLists[listIndex].totalItems = items.length;
                allLists[listIndex].itemCount = items.filter(item => item.checked).length;
                const progress = items.length > 0 ? Math.round((items.filter(item => item.checked).length / items.length) * 100) : 0;
                allLists[listIndex].progress = progress;
                saveUserLists(allLists);
            }
        }
    </script>
</body>
</html>